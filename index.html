<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Twitch Stream</title>
</head>
<body>
    <h1>Welcome to My Twitch Stream</h1>

    <!-- Button to initiate Twitch login -->
    <button id="twitch-login">Connect with Twitch</button>

    <p id="user-id"></p>

    <!-- Embedding the Twitch stream -->
    <div style="width: 100%; display: flex; justify-content: center;">
        <iframe
            src="https://player.twitch.tv/?channel=Hot_Shack&parent=coldshack.github.io"
            height="480"
            width="720"
            frameborder="0"
            scrolling="no"
            allowfullscreen="true">
        </iframe>
    </div>

    <!-- Embedding the Twitch chat -->
    <div style="width: 100%; display: flex; justify-content: center; margin-top: 20px;">
        <iframe
            src="https://www.twitch.tv/embed/Hot_Shack/chat?parent=coldshack.github.io"
            height="480"
            width="350"
            frameborder="0"
            scrolling="no">
        </iframe>
    </div>

    <script>
        const clientId = 'syvepx45yp2ufmzaf9ogo2luiqnrmj'; // Replace with your Twitch Client ID
        const redirectUri = 'https://coldshack.github.io/twitch_stream/callback'; // Replace with your GitHub Pages URL
        const scope = 'user:read:email'; // Adjust scopes as needed

        document.getElementById('twitch-login').onclick = function() {
            const authUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${scope}`;
            window.location.href = authUrl;
        };

        // Check for access token and fetch user info
        if (window.location.hash) {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const accessToken = params.get('access_token');

            if (accessToken) {
                fetch('https://api.twitch.tv/helix/users', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Client-Id': clientId
                    }
                })
                .then(response => response.json())
                .then(data => {
                    const userId = data.data[0].id;
                    document.getElementById('user-id').textContent = `Your Twitch User ID is: ${userId}`;
                });
            }
        }
    </script>
</body>
</html>
